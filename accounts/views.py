from django.shortcuts import render, redirect
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.forms import AuthenticationForm
from django.contrib import messages
from django.contrib.auth.decorators import login_required
from django.views.decorators.cache import never_cache
from django.urls import reverse
from django.views.decorators.csrf import ensure_csrf_cookie
from django.shortcuts import render

@ensure_csrf_cookie
@never_cache 
def login_view(request):
    
    if request.user.is_authenticated:
        return redirect('home')

    if request.method == 'POST':
        form = AuthenticationForm(request, data=request.POST)
        if form.is_valid():
            username = form.cleaned_data.get('username')
            password = form.cleaned_data.get('password')
            user = authenticate(username=username, password=password)
            if user is not None:
                login(request, user)
                return redirect('home')
            else:
                messages.error(request, "Invalid username or password.")
        else:
            messages.error(request, "Invalid username or password.")
            return redirect(reverse('login'))
    else:
        form = AuthenticationForm()
    return render(request, 'accounts/login.html', {'form': form})

@login_required
@never_cache
def home(request):
    widgets = [
        {
            "title": "Number of Crew",
            "number": 42,
            "svg": """<svg width="46" height="47" viewBox="0 0 46 47" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M30.6666 21.5833C33.8483 21.5833 36.3975 19.015 36.3975 15.8333C36.3975 12.6517 33.8483 10.0833 30.6666 10.0833C27.485 10.0833 24.9166 12.6517 24.9166 15.8333C24.9166 19.015 27.485 21.5833 30.6666 21.5833ZM15.3333 21.5833C18.515 21.5833 21.0641 19.015 21.0641 15.8333C21.0641 12.6517 18.515 10.0833 15.3333 10.0833C12.1516 10.0833 9.58329 12.6517 9.58329 15.8333C9.58329 19.015 12.1516 21.5833 15.3333 21.5833ZM15.3333 25.4167C10.8675 25.4167 1.91663 27.6592 1.91663 32.125V36.9167H28.75V32.125C28.75 27.6592 19.7991 25.4167 15.3333 25.4167ZM30.6666 25.4167C30.1108 25.4167 29.4783 25.455 28.8075 25.5125C31.0308 27.1225 32.5833 29.2883 32.5833 32.125V36.9167H44.0833V32.125C44.0833 27.6592 35.1325 25.4167 30.6666 25.4167Z" fill="black"/>
            </svg>"""
        },
        {
            "title": "Number of Admin/s",
            "number": 12,
            "svg": """<svg width="46" height="47" viewBox="0 0 46 47" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M30.6666 21.5833C33.8483 21.5833 36.3975 19.015 36.3975 15.8333C36.3975 12.6517 33.8483 10.0833 30.6666 10.0833C27.485 10.0833 24.9166 12.6517 24.9166 15.8333C24.9166 19.015 27.485 21.5833 30.6666 21.5833ZM15.3333 21.5833C18.515 21.5833 21.0641 19.015 21.0641 15.8333C21.0641 12.6517 18.515 10.0833 15.3333 10.0833C12.1516 10.0833 9.58329 12.6517 9.58329 15.8333C9.58329 19.015 12.1516 21.5833 15.3333 21.5833ZM15.3333 25.4167C10.8675 25.4167 1.91663 27.6592 1.91663 32.125V36.9167H28.75V32.125C28.75 27.6592 19.7991 25.4167 15.3333 25.4167ZM30.6666 25.4167C30.1108 25.4167 29.4783 25.455 28.8075 25.5125C31.0308 27.1225 32.5833 29.2883 32.5833 32.125V36.9167H44.0833V32.125C44.0833 27.6592 35.1325 25.4167 30.6666 25.4167Z" fill="black"/>
            </svg>"""
        },
        {
            "title": "Active Waybill/s",
            "number": 12,
            "svg": """<svg width="46" height="47" viewBox="0 0 46 47" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M3.83337 40.75V13.9167C3.83337 10.3018 3.83337 8.49633 4.95654 7.37317C6.07971 6.25 7.88521 6.25 11.5 6.25H30.6667C32.2614 6.25 33.4995 6.25 34.5077 6.30175C32.3976 6.53575 30.448 7.53978 29.032 9.12162C27.616 10.7035 26.8332 12.752 26.8334 14.875V21.5833L26.6436 40.6867L21.0834 38.8333L15.3334 40.75L9.58337 38.8333L3.83337 40.75ZM40.25 21.5833H30.6667V14.875C30.6667 13.6042 31.1715 12.3854 32.0702 11.4868C32.9688 10.5882 34.1875 10.0833 35.4584 10.0833C36.7292 10.0833 37.948 10.5882 38.8466 11.4868C39.7452 12.3854 40.25 13.6042 40.25 14.875V21.5833ZM7.66671 13.9167C7.66671 13.4083 7.86864 12.9208 8.22809 12.5614C8.58753 12.2019 9.07504 12 9.58337 12H21.0834C21.5917 12 22.0792 12.2019 22.4387 12.5614C22.7981 12.9208 23 13.4083 23 13.9167C23 14.425 22.7981 14.9125 22.4387 15.272C22.0792 15.6314 21.5917 15.8333 21.0834 15.8333H9.58337C9.07504 15.8333 8.58753 15.6314 8.22809 15.272C7.86864 14.9125 7.66671 14.425 7.66671 13.9167ZM7.66671 21.5833C7.66671 21.075 7.86864 20.5875 8.22809 20.228C8.58753 19.8686 9.07504 19.6667 9.58337 19.6667H13.4167C13.925 19.6667 14.4126 19.8686 14.772 20.228C15.1314 20.5875 15.3334 21.075 15.3334 21.5833C15.3334 22.0917 15.1314 22.5792 14.772 22.9386C14.4126 23.2981 13.925 23.5 13.4167 23.5H9.58337C9.07504 23.5 8.58753 23.2981 8.22809 22.9386C7.86864 22.5792 7.66671 22.0917 7.66671 21.5833ZM7.66671 29.25C7.66671 28.7417 7.86864 28.2542 8.22809 27.8947C8.58753 27.5353 9.07504 27.3333 9.58337 27.3333H17.25C17.7584 27.3333 18.2459 27.5353 18.6053 27.8947C18.9648 28.2542 19.1667 28.7417 19.1667 29.25C19.1667 29.7583 18.9648 30.2458 18.6053 30.6053C18.2459 30.9647 17.7584 31.1667 17.25 31.1667H9.58337C9.07504 31.1667 8.58753 30.9647 8.22809 30.6053C7.86864 30.2458 7.66671 29.7583 7.66671 29.25Z" fill="black"/>
            </svg>"""
        },
        {
            "title": "Total Collection",
            "number": 12,
            "svg": """<svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M23 30.6667C21.9458 30.6667 21.0437 30.2916 20.2937 29.5416C19.5436 28.7915 19.1679 27.8888 19.1667 26.8333C19.1654 25.7779 19.5411 24.8758 20.2937 24.127C21.0463 23.3782 21.9484 23.0026 23 23C24.0516 22.9974 24.9544 23.3731 25.7083 24.127C26.4621 24.8809 26.8372 25.783 26.8333 26.8333C26.8295 27.8837 26.4545 28.7864 25.7083 29.5416C24.962 30.2967 24.0593 30.6718 23 30.6667ZM14.1354 13.4167H31.8646L35.6979 5.75H10.3021L14.1354 13.4167ZM16.1 40.25H29.9C32.775 40.25 35.2187 39.2521 37.2312 37.2562C39.2437 35.2603 40.25 32.8082 40.25 29.9C40.25 28.6861 40.0424 27.5042 39.6271 26.3542C39.2118 25.2042 38.6208 24.166 37.8542 23.2396L32.8708 17.25H13.1292L8.14583 23.2396C7.37917 24.166 6.78819 25.2042 6.37292 26.3542C5.95764 27.5042 5.75 28.6861 5.75 29.9C5.75 32.8069 6.74858 35.259 8.74575 37.2562C10.7429 39.2533 13.1943 40.2513 16.1 40.25Z" fill="black"/>
            </svg>"""
        },
        # Add more widgets as needed
    ]
    return render(request, 'accounts/home.html', {"widgets": widgets})

def logout_view(request):
    logout(request)
    return redirect('login')